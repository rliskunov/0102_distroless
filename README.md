# Week 01. Distroless Task (Slurm –ù–∞–≤—ã–∫—É–º "Build Containers!")

## –ó–∞–¥–∞—á–∞

–ï—Å—Ç—å —Å–µ—Ä–≤–∏—Å –Ω–∞ Go (–∏—Å—Ö–æ–¥–Ω–∏–∫–∏ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —ç—Ç–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ) –∏ –¥–ª—è –Ω–µ–≥–æ –¥–∞–∂–µ –Ω–∞–ø–∏—Å–∞–Ω `Dockerfile` –∏ `docker-compose.yml`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≥–æ–≤–æ—Ä—è—Ç*, —á—Ç–æ –ó–∞–∫–∞–∑—á–∏–∫ —Ç—Ä–µ–±–æ–≤–∞–ª –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑—ã [Distroless Base Debian11](https://github.com/GoogleContainerTools/distroless) –∏ –æ–Ω–∏ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ. –í–∞–º –Ω—É–∂–Ω–æ –ª–∏—à—å "–Ω–µ–º–Ω–æ–≥–æ" –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å üòä (—Ü–∏—Ç–∞—Ç–∞: "–Ω—É —É –≤–∞—Å –∂–µ –µ—Å—Ç—å —Ç–∞–º –≤—Å—è–∫–∏–µ –¥–µ–≤–æ–ø—Å–µ—Ä—Å–∫–∏–µ –∑–∞–º–æ—Ä–æ—á–∫–∏, —Ç–∏–ø–∞ –∫–∞–∫ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Å–∏–≤–æ" üòà).

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ*: —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º, –∫–æ–Ω–µ—á–Ω–æ –∂–µ, –Ω—É–∂–Ω–æ –¥–æ–≤–µ—Ä—è—Ç—å, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤—Å—ë –ª–∏ —Ç–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ—Ä–Ω–æ.

### –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫–∞–∑–∞–ª —Å–ª–µ–¥—É—é—â–µ–µ (–¥–æ—Å–ª–æ–≤–Ω–æ):
> –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –Ω–∞ Go, —Å–±–æ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∞ –≤ `Dockerfile`, —Ä—è–¥–æ–º `docker-compose.yml`, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –≤–º–µ—Å—Ç–µ —Å –°–£–ë–î
>
> –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
> ```shell
> ./app -port=8000 -host=... -dbUrl=...
> ```
>
> –ü–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å —Å —Ñ–ª–∞–≥–æ–≤ –Ω–∞ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ –Ω–µ –Ω—É–∂–Ω–æ, –ø—É—Å—Ç—å –æ—Å—Ç–∞—é—Ç—Å—è —Ñ–ª–∞–≥–∏, –Ω–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ñ–ª–∞–≥–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:
> 
> ```shell
> docker run -e APP_PORT=9999 ...
> ```
> 
> –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å `POST` –æ–±—ã—á–Ω—ã–º `application/x-www-form-urlencoded` –Ω–∞ `http://localhost:9000/api/events` —Å–ª–µ–¥—É—é—â–µ–≥–æ –≤–∏–¥–∞:
> ```
> action=view&product=k8s&fingerprint=XYZ
> ```
> –í –æ—Ç–≤–µ—Ç –ø—Ä–∏–¥—ë—Ç –∫–æ–¥ 200

–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å (–¥–æ—Å–ª–æ–≤–Ω–æ):
> –£–ø–∞–∫–æ–≤–∞—Ç—å –≤—Å—ë –≤ Docker —Ç–∞–∫, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—Å–µ —Ñ–ª–∞–≥–∏ –∑–∞–¥–∞–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–∏ —ç—Ç–æ–º –¥–µ–ª–∞—Ç—å `ENTRYPOINT` –∏–ª–∏ `CMD` –≤ –≤–∏–¥–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ, –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –¥–æ–ª–∂–µ–Ω –∏–º–µ–Ω–Ω–æ `app`)
> 
> –ù–∏–∫–∞–∫–∏—Ö `entrypoint.sh` –∏ –¥—Ä—É–≥–∏—Ö sh-—Å–∫—Ä–∏–ø—Ç–æ–≤ –ø–∏—Å–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
> 
> –ü–µ—Ä–µ–¥–µ–ª—ã–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥) —Ç–æ–∂–µ –Ω–µ –Ω—É–∂–Ω–æ
> 
> –ù–∏–∫–∞–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–æ–∫ —Å—Ç–∏–ª—è –∫–æ–¥–∞, –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–≤ —Ç–æ–º —á–∏—Å–ª–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –æ–±—Ä–∞–∑–æ–≤ –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏) –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
>
> –°–±–æ—Ä–∫—É –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ Multi-Stage, –≤–∑—è–≤ –∑–∞ –æ—Å–Ω–æ–≤—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `Dockerfile` (–Ω—É–∂–Ω–æ –≤–Ω–µ—Å—Ç–∏ –≤ –Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å –Ω—É–ª—è –Ω–æ–≤—ã–π)
>
> –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ª–∏–Ω–∫–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
>
> –ó–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –Ω–µ –æ—Ç root'–∞ (–ø—Ä–æ–ø–∏—Å—ã–≤–∞–π—Ç–µ —ç—Ç–æ —è–≤–Ω–æ –≤ `Dockerfile`)
> 
> –í—ã–ª–æ–∂–∏—Ç—å –≤—Å—ë –≤ –≤–∏–¥–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –Ω–∞ GHCR (GitHub Container Registry), —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ —Å–∞–º–∏ –∑–∞—Ç–µ—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. –í—Å—ë –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ –≤ –≤–∏–¥–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub
2. –í—Å—è —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ GitHub Actions
3. –û–±—Ä–∞–∑ –¥–æ–ª–∂–µ–Ω –≤—ã–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –≤ GitHub Container Registry (GHCR)

–ö —Ç–µ–∫—É—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—ä—è–≤–ª—è—é—Ç—Å—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
1. Docker Legacy Build ([`DOCKER_BUILDKIT=0 docker build .`](https://github.com/docker/cli/pull/3314))
2. Multi-Stage
